{% extends 'base_new.html' %}

{% block title %}è°ƒè¯•è‚¡ç¥¨ç®¡ç† - æŠ•èµ„é¡¹ç›®æŠ«éœ²å¹³å°{% endblock %}

{% block content %}
<div class="desktop-nav">
    <a href="{% url 'dashboard' %}"><span id="nav-home">é¦–é¡µ</span></a>
    <a href="/accounts/"><span id="nav-account-list">è´¦æˆ·åˆ—è¡¨</span></a>
    <a href="/accounts/{{ account_id }}/"><span id="nav-account-detail">è´¦æˆ·è¯¦æƒ…</span></a>
    <a href="#" class="active"><span id="nav-debug-securities">è°ƒè¯•è‚¡ç¥¨ç®¡ç†</span></a>
</div>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">ğŸ” è°ƒè¯•è‚¡ç¥¨ç®¡ç†</h2>
    </div>
    <div class="card-body">
        <div id="debugInfo">
            <h3>è°ƒè¯•ä¿¡æ¯</h3>
            <p><strong>è´¦æˆ·ID:</strong> {{ account_id }}</p>
            <p><strong>APIåŸºç¡€URL:</strong> /api/v1</p>
            <p><strong>å®Œæ•´API URL:</strong> /api/v1/securities/?account={{ account_id }}</p>
            
            <button class="btn btn-primary" onclick="testAPI()">æµ‹è¯•API</button>
            <button class="btn btn-secondary" onclick="testAccounts()">æµ‹è¯•è´¦æˆ·API</button>
            <button class="btn btn-info" onclick="testAllSecurities()">æµ‹è¯•æ‰€æœ‰è‚¡ç¥¨</button>
            
            <div id="testResults" style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px;">
                <h4>æµ‹è¯•ç»“æœ:</h4>
                <div id="results">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
            </div>
        </div>
    </div>
</div>

<style>
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    margin: 5px;
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-info {
    background: #17a2b8;
    color: white;
}

#results {
    white-space: pre-wrap;
    font-family: monospace;
    font-size: 12px;
    max-height: 400px;
    overflow-y: auto;
}
</style>

<script>
let accountId = {{ account_id }};

function log(message) {
    const results = document.getElementById('results');
    results.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
}

async function testAPI() {
    log('å¼€å§‹æµ‹è¯•è‚¡ç¥¨API...');
    log('è¯·æ±‚URL: /api/v1/securities/?account=' + accountId);
    
    try {
        log('æ£€æŸ¥APIå¯¹è±¡...');
        if (typeof API === 'undefined') {
            log('âŒ APIå¯¹è±¡æœªå®šä¹‰');
            return;
        }
        log('âœ… APIå¯¹è±¡å·²å®šä¹‰');
        
        log('å‘é€è¯·æ±‚...');
        const response = await API.get(`/securities/?account=${accountId}`);
        log('âœ… è¯·æ±‚æˆåŠŸ');
        log('å“åº”æ•°æ®: ' + JSON.stringify(response, null, 2));
        
    } catch (error) {
        log('âŒ è¯·æ±‚å¤±è´¥');
        log('é”™è¯¯ç±»å‹: ' + error.constructor.name);
        log('é”™è¯¯ä¿¡æ¯: ' + error.message);
        log('é”™è¯¯è¯¦æƒ…: ' + JSON.stringify(error, null, 2));
    }
}

async function testAccounts() {
    log('å¼€å§‹æµ‹è¯•è´¦æˆ·API...');
    
    try {
        const response = await API.get(`/accounts/${accountId}/`);
        log('âœ… è´¦æˆ·APIæˆåŠŸ');
        log('è´¦æˆ·æ•°æ®: ' + JSON.stringify(response, null, 2));
    } catch (error) {
        log('âŒ è´¦æˆ·APIå¤±è´¥');
        log('é”™è¯¯: ' + error.message);
    }
}

async function testAllSecurities() {
    log('å¼€å§‹æµ‹è¯•æ‰€æœ‰è‚¡ç¥¨APIï¼ˆä¸æŒ‡å®šè´¦æˆ·ï¼‰...');
    
    try {
        const response = await API.get('/securities/');
        log('âœ… æ‰€æœ‰è‚¡ç¥¨APIæˆåŠŸ');
        log('è‚¡ç¥¨æ•°é‡: ' + response.length);
        log('è‚¡ç¥¨æ•°æ®: ' + JSON.stringify(response, null, 2));
    } catch (error) {
        log('âŒ æ‰€æœ‰è‚¡ç¥¨APIå¤±è´¥');
        log('é”™è¯¯: ' + error.message);
    }
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    log('é¡µé¢åŠ è½½å®Œæˆ');
    log('è´¦æˆ·ID: ' + accountId);
    log('å¼€å§‹è°ƒè¯•...');
});
</script>

{% endblock %}
