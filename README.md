# Stocks-Lab - æŠ•èµ„é¡¹ç›®åªè¯»æŠ«éœ²å¹³å°

[![ä¸­æ–‡ç•Œé¢](screenshots/CHs.png)](screenshots/CHs.png)
[![English Interface](screenshots/Eng.png)](screenshots/Eng.png)

**ä¸­æ–‡** | [English](#stocks-lab---investment-portfolio-disclosure-platform)

è¿™æ˜¯ä¸€ä¸ªåŸºäº Django + Django REST Framework çš„æŠ•èµ„é¡¹ç›®æŠ«éœ²å¹³å°ï¼Œä¸“ä¸ºæŠ•èµ„è€…è®¾è®¡ï¼Œæä¾›å®Œæ•´çš„äº¤æ˜“è®°å½•ç®¡ç†ã€ç›ˆäºåˆ†æã€åˆ†äº«å¯¼å‡ºç­‰åŠŸèƒ½ã€‚é‡‡ç”¨ Mobile-first å“åº”å¼è®¾è®¡ï¼Œå®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ã€‚

## ğŸŒŸ ä¸»è¦äº®ç‚¹

- **ğŸ“Š æ’®åˆäº¤æ˜“æ™ºèƒ½è¯†åˆ«** - è‡ªåŠ¨åŒ¹é…å¼€ä»“å’Œå¹³ä»“è®°å½•ï¼Œæ˜¾ç¤ºå®Œæ•´äº¤æ˜“å¯¹ä¿¡æ¯
- **ğŸ“¸ äº¤æ˜“åˆ†äº«åŠŸèƒ½** - ç”Ÿæˆå¯Œé€”é£æ ¼çš„äº¤æ˜“åˆ†äº«å›¾ç‰‡ï¼Œæ”¯æŒè‡ªå®šä¹‰å¸ƒå±€å’ŒäºŒç»´ç 
- **ğŸ“ äº¤æ˜“ç¬”è®°å¯¼å‡º** - å¯¼å‡ºè¯¦ç»†çš„äº¤æ˜“ç¬”è®°ï¼ŒåŒ…å«å¼€ä»“å’Œå¹³ä»“çš„å®Œæ•´ä¿¡æ¯
- **ğŸ“± å“åº”å¼è®¾è®¡** - å®Œç¾é€‚é…æ‰‹æœºã€å¹³æ¿å’Œæ¡Œé¢è®¾å¤‡
- **ğŸŒ å¤šè¯­è¨€æ”¯æŒ** - ä¸­è‹±æ–‡ç•Œé¢åˆ‡æ¢ï¼Œæ»¡è¶³ä¸åŒç”¨æˆ·éœ€æ±‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **é¡¹ç›®ç®¡ç†**ï¼šåˆ›å»ºå’Œç®¡ç†å¤šä¸ªæŠ•èµ„é¡¹ç›®
- **æˆå‘˜æƒé™**ï¼šåŸºäºé¡¹ç›®çš„è§’è‰²æƒé™æ§åˆ¶ï¼ˆADMIN/VIEWERï¼‰
- **å‡ºèµ„è®°å½•**ï¼šè®°å½•é¡¹ç›®æˆå‘˜çš„å‡ºèµ„ä¿¡æ¯
- **æ—¥ç»“ä½™**ï¼šæ¯æ—¥æ‰‹åŠ¨è®°å½•è´¦æˆ·ä½™é¢ï¼Œæ”¯æŒå‡€å€¼æ›²çº¿æŸ¥çœ‹
- **äº¤æ˜“è®°å½•**ï¼šè¯¦ç»†è®°å½•æ¯ç¬”äº¤æ˜“ï¼ŒåŒ…å«ç†è®ºä¾æ®å’Œå¤ç›˜
- **æ’®åˆäº¤æ˜“**ï¼šæ™ºèƒ½è¯†åˆ«å¼€ä»“å’Œå¹³ä»“äº¤æ˜“å¯¹ï¼Œæ˜¾ç¤ºå®Œæ•´äº¤æ˜“ä¿¡æ¯
- **äº¤æ˜“åˆ†äº«**ï¼šç”Ÿæˆå¯Œé€”é£æ ¼çš„äº¤æ˜“åˆ†äº«å›¾ç‰‡ï¼Œæ”¯æŒè‡ªå®šä¹‰å¸ƒå±€
- **äº¤æ˜“ç¬”è®°**ï¼šå¯¼å‡ºè¯¦ç»†çš„äº¤æ˜“ç¬”è®°ï¼ŒåŒ…å«å¼€ä»“å’Œå¹³ä»“ä¿¡æ¯
- **æŒä»“åˆ†äº«**ï¼šç”ŸæˆæŒä»“æ¦‚è§ˆåˆ†äº«å›¾ï¼Œæ”¯æŒäºŒç»´ç é›†æˆ
- **é™„ä»¶ç®¡ç†**ï¼šæ”¯æŒäº¤æ˜“å’Œæ—¥ç»“ä½™æ·»åŠ å›¾ç‰‡é™„ä»¶
- **å®¡è®¡æ—¥å¿—**ï¼šè‡ªåŠ¨è®°å½•æ‰€æœ‰å…³é”®æ“ä½œ

### æƒé™æ§åˆ¶
- èµ„æºçº§æƒé™åŸºäº ProjectMember
- æœªåŠ å…¥é¡¹ç›®çš„ç”¨æˆ·æ— æ³•è®¿é—®é¡¹ç›®æ•°æ®ï¼ˆ403ï¼‰
- VIEWER è§’è‰²åªèƒ½æŸ¥çœ‹ï¼ˆGET/HEAD/OPTIONSï¼‰
- ADMIN è§’è‰²å¯ä»¥è¿›è¡Œæ‰€æœ‰æ“ä½œï¼ˆPOST/PUT/PATCH/DELETEï¼‰
- é™„ä»¶è®¿é—®ä¹Ÿéœ€è¦éªŒè¯é¡¹ç›®æƒé™

### å‰ç«¯ç‰¹æ€§
- Mobile-first å“åº”å¼è®¾è®¡
- æ‰‹æœºåº•éƒ¨ Tab å¯¼èˆª
- å¤§æŒ‰é’®å‹å¥½æ“ä½œ
- æ•°å­—é”®ç›˜è¾“å…¥
- å¡ç‰‡å¼åˆ—è¡¨å±•ç¤º
- Markdown æ”¯æŒï¼ˆäº¤æ˜“ä¾æ®å’Œå¤ç›˜ï¼‰

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚
- Python 3.8+
- Node.js 16+ å’Œ npm
- pip

### 2. åˆå§‹åŒ–é¡¹ç›®

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/Html-Project/Stocks-Lab

# åˆå§‹åŒ–åç«¯
./manage.sh setup
./manage.sh migrate
./manage.sh admin

# å®‰è£…å‰ç«¯ä¾èµ–
cd frontend && npm install && cd ..

# ï¼ˆå¯é€‰ï¼‰ç”Ÿæˆæµ‹è¯•æ•°æ®
source venv/bin/activate
python create_test_data.py
```

### 3. å¯åŠ¨å¼€å‘ç¯å¢ƒ

**æ–¹å¼ä¸€ï¼šç»Ÿä¸€å¯åŠ¨ï¼ˆæ¨èï¼‰**
```bash
./start_dev.sh
```

è¿™ä¼šä½¿ç”¨ tmux åŒæ—¶å¯åŠ¨å‰åç«¯æœåŠ¡ã€‚

**æ–¹å¼äºŒï¼šåˆ†åˆ«å¯åŠ¨**
```bash
# ç»ˆç«¯ 1 - å¯åŠ¨åç«¯ï¼ˆç«¯å£ 20004ï¼‰
./manage.sh run

# ç»ˆç«¯ 2 - å¯åŠ¨å‰ç«¯ï¼ˆç«¯å£ 20003ï¼‰
cd frontend && npm run dev
```

### 4. è®¿é—®ç³»ç»Ÿ

- **å‰ç«¯ç•Œé¢**: http://localhost:20003
- **åç«¯ç®¡ç†**: http://localhost:20004/admin
- **API ç«¯ç‚¹**: http://localhost:20004/api/v1

æµ‹è¯•è´¦æˆ·ï¼ˆè¿è¡Œ `create_test_data.py` åï¼‰ï¼š
- ç®¡ç†å‘˜: `admin` / `admin123`

### 5. ç®¡ç†å‘˜å¯†ç ä¿®æ”¹

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰**
```bash
# ä¿®æ”¹å¯†ç 
./change_admin_password.sh æ–°å¯†ç 

# ç¤ºä¾‹
./change_admin_password.sh mynewpassword123
```

**æ–¹æ³•äºŒï¼šDjangoå‘½ä»¤**
```bash
source venv/bin/activate
python manage.py shell
# ç„¶åæ‰§è¡Œï¼š
from django.contrib.auth.models import User
admin = User.objects.get(username='admin')
admin.set_password('æ–°å¯†ç ')
admin.save()
```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š[ADMIN_PASSWORD_GUIDE.md](ADMIN_PASSWORD_GUIDE.md)

æµ‹è¯•è´¦æˆ·ï¼ˆè¿è¡Œ `create_test_data.py` åï¼‰ï¼š
- è§‚å¯Ÿè€…: `viewer` / `viewer123`

### 6. åœæ­¢æœåŠ¡

```bash
./stop_dev.sh
```

**è¯¦ç»†ç«¯å£é…ç½®è¯´æ˜**: è§ [PORT_CONFIGURATION.md](PORT_CONFIGURATION.md)

## ä½¿ç”¨æµç¨‹

### åˆ›å»ºé¡¹ç›®å’Œæ·»åŠ æˆå‘˜

1. ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•åå°ï¼šhttp://localhost:8002/admin
2. åœ¨ "æŠ•èµ„é¡¹ç›®" ä¸­åˆ›å»ºæ–°é¡¹ç›®
3. åœ¨ "é¡¹ç›®æˆå‘˜" ä¸­æ·»åŠ æˆå‘˜ï¼š
   - é€‰æ‹©é¡¹ç›®
   - é€‰æ‹©ç”¨æˆ·
   - è®¾ç½®è§’è‰²ï¼ˆADMIN æˆ– VIEWERï¼‰

### æ·»åŠ å‡ºèµ„è®°å½•

1. è¿›å…¥åå° "å‡ºèµ„è®°å½•"
2. ç‚¹å‡» "æ–°å¢å‡ºèµ„è®°å½•"
3. å¡«å†™å‡ºèµ„ä¿¡æ¯ï¼š
   - é€‰æ‹©é¡¹ç›®
   - é€‰æ‹©å‡ºèµ„äºº
   - å¡«å†™é‡‘é¢
   - å¡«å†™å‡ºèµ„æ—¥æœŸ

### ä½¿ç”¨å‰ç«¯ç•Œé¢

1. ä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•å‰å°ï¼šhttp://localhost:8002
2. åœ¨ä»ªè¡¨ç›˜é€‰æ‹©é¡¹ç›®
3. ç®¡ç†å‘˜å¯ä»¥ï¼š
   - æ·»åŠ æ—¥ç»“ä½™è®°å½•
   - æ·»åŠ äº¤æ˜“è®°å½•
   - æŸ¥çœ‹æ‰€æœ‰æ•°æ®
4. è§‚å¯Ÿè€…å¯ä»¥ï¼š
   - æŸ¥çœ‹æ—¥ç»“ä½™
   - æŸ¥çœ‹äº¤æ˜“è®°å½•
   - æŸ¥çœ‹å‡ºèµ„è®°å½•

## ç«¯å£é…ç½®

æœ¬é¡¹ç›®é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼š

- **å‰ç«¯å¼€å‘æœåŠ¡å™¨**: http://localhost:20003
- **åç«¯ API æœåŠ¡å™¨**: http://localhost:20004

è¯¦ç»†é…ç½®è§ï¼š[PORT_CONFIGURATION.md](PORT_CONFIGURATION.md)

## API ç«¯ç‚¹

**Base URL**: `http://localhost:20004/api/v1`

### è®¤è¯
- `POST /login/` - ç™»å½•ï¼ˆDjango sessionï¼‰
- `POST /logout/` - ç™»å‡º
- `GET /api/v1/me/` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### é¡¹ç›®
- `GET /api/v1/projects/` - è·å–æˆ‘å¯è§çš„é¡¹ç›®åˆ—è¡¨
- `POST /api/v1/projects/` - åˆ›å»ºé¡¹ç›®ï¼ˆè‡ªåŠ¨æˆä¸ºç®¡ç†å‘˜ï¼‰
- `GET /api/v1/projects/{id}/` - è·å–é¡¹ç›®è¯¦æƒ…
- `GET /api/v1/projects/{id}/members/` - è·å–é¡¹ç›®æˆå‘˜
- `POST /api/v1/projects/{id}/add_member/` - æ·»åŠ æˆå‘˜ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

### å‡ºèµ„è®°å½•
- `GET /api/v1/contributions/` - è·å–å‡ºèµ„è®°å½•åˆ—è¡¨
- `POST /api/v1/contributions/` - åˆ›å»ºå‡ºèµ„è®°å½•ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
- `GET /api/v1/contributions/{id}/` - è·å–å‡ºèµ„è®°å½•è¯¦æƒ…

### æ—¥ç»“ä½™
- `GET /api/v1/balances/` - è·å–æ—¥ç»“ä½™åˆ—è¡¨
  - æŸ¥è¯¢å‚æ•°ï¼š`project`, `from_date`, `to_date`
- `POST /api/v1/balances/` - åˆ›å»ºæ—¥ç»“ä½™ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
- `GET /api/v1/balances/{id}/` - è·å–æ—¥ç»“ä½™è¯¦æƒ…
- `PATCH /api/v1/balances/{id}/` - æ›´æ–°æ—¥ç»“ä½™ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

### å‡€å€¼æ›²çº¿
- `GET /api/v1/balance-summary/?project={id}` - è·å–é¡¹ç›®å‡€å€¼æ›²çº¿
  - è¿”å›ï¼š`[{date, balance, delta, return_pct}]`

### äº¤æ˜“è®°å½•
- `GET /api/v1/trades/` - è·å–äº¤æ˜“è®°å½•åˆ—è¡¨
  - æŸ¥è¯¢å‚æ•°ï¼š`project`, `symbol`, `side`, `from_date`, `to_date`
- `POST /api/v1/trades/` - åˆ›å»ºäº¤æ˜“è®°å½•ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
- `GET /api/v1/trades/{id}/` - è·å–äº¤æ˜“è®°å½•è¯¦æƒ…
- `PATCH /api/v1/trades/{id}/` - æ›´æ–°äº¤æ˜“è®°å½•ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

### é™„ä»¶
- `GET /api/v1/attachments/` - è·å–é™„ä»¶åˆ—è¡¨
  - æŸ¥è¯¢å‚æ•°ï¼š`owner_type`, `owner_id`
- `POST /api/v1/attachments/` - ä¸Šä¼ é™„ä»¶ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
- `GET /api/v1/attachments/{id}/` - è·å–é™„ä»¶è¯¦æƒ…

### å®¡è®¡æ—¥å¿—
- `GET /api/v1/audit-logs/` - è·å–å®¡è®¡æ—¥å¿—ï¼ˆåªèƒ½çœ‹åˆ°è‡ªå·±çš„æ“ä½œï¼‰
  - æŸ¥è¯¢å‚æ•°ï¼š`action`, `model_type`, `model_id`

## ç®¡ç†å‘½ä»¤

```bash
# ç»Ÿä¸€å¯åŠ¨å‰åç«¯
./start_dev.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡
./stop_dev.sh

# æ£€æŸ¥ç«¯å£çŠ¶æ€
./check_ports.sh

# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
./manage.sh status

# æ‰§è¡Œæ•°æ®åº“è¿ç§»
./manage.sh migrate

# åˆ›å»ºç®¡ç†å‘˜
./manage.sh admin

# å¯åŠ¨åç«¯æœåŠ¡å™¨ï¼ˆç«¯å£ 20004ï¼‰
./manage.sh run

# å¯åŠ¨å‰ç«¯æœåŠ¡å™¨ï¼ˆç«¯å£ 20003ï¼‰
cd frontend && npm run dev

# è¿›å…¥ Django Shell
./manage.sh shell

# æ”¶é›†é™æ€æ–‡ä»¶
./manage.sh static

# æ¸…ç†ç¼“å­˜æ–‡ä»¶
./manage.sh clean

# å¤‡ä»½æ•°æ®åº“
./manage.sh backup
```

## é¡¹ç›®ç»“æ„

```
Stocks-Lab/
â”œâ”€â”€ manage.py                 # Django ç®¡ç†è„šæœ¬
â”œâ”€â”€ manage.sh                 # é¡¹ç›®ç®¡ç†è„šæœ¬
â”œâ”€â”€ requirements.txt          # Python ä¾èµ–
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore               # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ db.sqlite3               # SQLite æ•°æ®åº“
â”œâ”€â”€ stocks_lab/              # Django é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py          # é¡¹ç›®è®¾ç½®
â”‚   â”œâ”€â”€ urls.py              # ä¸»è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ wsgi.py
â”‚   â””â”€â”€ asgi.py
â”œâ”€â”€ core/                     # æ ¸å¿ƒåº”ç”¨
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ models.py            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ serializers.py       # DRF åºåˆ—åŒ–å™¨
â”‚   â”œâ”€â”€ viewsets.py          # DRF è§†å›¾é›†
â”‚   â”œâ”€â”€ views.py             # å‰ç«¯è§†å›¾
â”‚   â”œâ”€â”€ permissions.py       # æƒé™ç±»
â”‚   â”œâ”€â”€ urls.py              # API è·¯ç”±
â”‚   â”œâ”€â”€ admin.py             # ç®¡ç†åå°é…ç½®
â”‚   â””â”€â”€ apps.py
â”œâ”€â”€ templates/                # å‰ç«¯æ¨¡æ¿
â”‚   â”œâ”€â”€ base.html            # åŸºç¡€æ¨¡æ¿
â”‚   â”œâ”€â”€ login.html           # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ dashboard.html       # ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ projects.html        # é¡¹ç›®åˆ—è¡¨
â”‚   â”œâ”€â”€ project_detail.html  # é¡¹ç›®è¯¦æƒ…
â”‚   â”œâ”€â”€ balances.html        # æ—¥ç»“ä½™
â”‚   â”œâ”€â”€ trades.html          # äº¤æ˜“è®°å½•
â”‚   â”œâ”€â”€ contributions.html   # å‡ºèµ„è®°å½•
â”‚   â””â”€â”€ 403.html            # æ— æƒé™é¡µé¢
â”œâ”€â”€ media/                    # åª’ä½“æ–‡ä»¶ï¼ˆé™„ä»¶å­˜å‚¨ï¼‰
â””â”€â”€ static/                   # é™æ€æ–‡ä»¶
```

## æŠ€æœ¯æ ˆ

### åç«¯
- Django 4.2.9
- Django REST Framework 3.14.0
- django-cors-headers 4.3.1
- django-filter 23.5
- Pillow 10.1.0ï¼ˆå›¾ç‰‡å¤„ç†ï¼‰
- Markdown 3.5.1ï¼ˆMarkdown æ¸²æŸ“ï¼‰

### å‰ç«¯
- Django Templates
- åŸç”Ÿ JavaScriptï¼ˆFetch APIï¼‰
- å“åº”å¼ CSSï¼ˆMobile-firstï¼‰

### æ•°æ®åº“
- SQLite3ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- å¯è½»æ¾åˆ‡æ¢åˆ° PostgreSQL/MySQL

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°åŠŸèƒ½

1. ä¿®æ”¹ `core/models.py` æ·»åŠ æ–°æ¨¡å‹
2. è¿è¡Œ `./manage.sh migrate` åˆ›å»ºæ•°æ®åº“è¡¨
3. åœ¨ `core/serializers.py` æ·»åŠ åºåˆ—åŒ–å™¨
4. åœ¨ `core/viewsets.py` æ·»åŠ è§†å›¾é›†
5. åœ¨ `core/urls.py` æ³¨å†Œè·¯ç”±
6. åœ¨ `core/admin.py` æ³¨å†Œç®¡ç†åå°

### è‡ªå®šä¹‰æƒé™

åœ¨ `core/permissions.py` ä¸­ç»§æ‰¿ `BasePermission` ç±»ï¼Œå®ç°è‡ªå®šä¹‰æƒé™é€»è¾‘ã€‚

### æ·»åŠ å®¡è®¡æ—¥å¿—

ä½¿ç”¨ `create_audit_log()` å‡½æ•°è®°å½•æ“ä½œï¼š

```python
from core.viewsets import create_audit_log

create_audit_log(
    action='CREATE',  # CREATE/UPDATE/DELETE
    model_type='YourModel',
    model_id=obj.id,
    user=request.user,
    changes={'field': 'value'}
)
```

## ç”Ÿäº§éƒ¨ç½²å»ºè®®

1. **æ›´æ”¹ SECRET_KEY**ï¼šç”Ÿæˆæ–°çš„å¯†é’¥å¹¶è®¾ç½®åˆ° `.env`
2. **å…³é—­ DEBUG**ï¼šè®¾ç½® `DEBUG=False`
3. **é…ç½® ALLOWED_HOSTS**ï¼šæ·»åŠ æ‚¨çš„åŸŸå
4. **ä½¿ç”¨ PostgreSQL**ï¼šæ›¿æ¢ SQLite æ•°æ®åº“
5. **é…ç½® S3**ï¼šå°†é™„ä»¶å­˜å‚¨è¿ç§»åˆ° S3
6. **ä½¿ç”¨ Nginx + Gunicorn**ï¼šç”Ÿäº§ç¯å¢ƒ Web æœåŠ¡å™¨
7. **å¯ç”¨ HTTPS**ï¼šé…ç½® SSL è¯ä¹¦
8. **æ”¶é›†é™æ€æ–‡ä»¶**ï¼šè¿è¡Œ `./manage.sh static`

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•é‡ç½®å¯†ç ï¼Ÿ
A: ä½¿ç”¨ç®¡ç†åå°æˆ– Django Shellï¼š
```python
from django.contrib.auth.models import User
user = User.objects.get(username='ç”¨æˆ·å')
user.set_password('æ–°å¯†ç ')
user.save()
```

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ
A: è¿è¡Œ `./manage.sh backup` è‡ªåŠ¨å¤‡ä»½ SQLite æ•°æ®åº“ã€‚

### Q: å¦‚ä½•åˆ‡æ¢åˆ° PostgreSQLï¼Ÿ
A: ä¿®æ”¹ `stocks_lab/settings.py` ä¸­çš„ `DATABASES` é…ç½®ã€‚

### Q: é™„ä»¶ä¸Šä¼ å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥ `media/` ç›®å½•æƒé™ï¼Œç¡®ä¿ Django è¿›ç¨‹æœ‰å†™å…¥æƒé™ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œä¸ªäººä½¿ç”¨ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚

---

**æ³¨æ„**ï¼šè¿™æ˜¯ä¸€ä¸ªæŠ«éœ²å¹³å°ï¼Œä¸æ˜¯äº¤æ˜“ç³»ç»Ÿï¼Œä¸æ¥å…¥åˆ¸å•† APIã€‚æ‰€æœ‰æ•°æ®å‡ä¸ºæ‰‹åŠ¨å½•å…¥ã€‚

---

# Stocks-Lab - Investment Portfolio Disclosure Platform

[![Chinese Interface](screenshots/CHs.png)](screenshots/CHs.png)
[![English Interface](screenshots/Eng.png)](screenshots/Eng.png)

[ä¸­æ–‡](#stocks-lab---æŠ•èµ„é¡¹ç›®åªè¯»æŠ«éœ²å¹³å°) | **English**

An investment portfolio disclosure platform based on Django + Django REST Framework, specifically designed for investors to manage trading records, analyze profits/losses, and export/share trading information. Features mobile-first responsive design that perfectly adapts to desktop and mobile devices. **Now with full internationalization support (Chinese/English).**

## ğŸŒŸ Key Highlights

- **ğŸ“Š Smart Trade Matching** - Automatically matches opening and closing trades, displaying complete trade pair information
- **ğŸ“¸ Trade Sharing Feature** - Generate Futu-style trading share images with customizable layouts and QR codes
- **ğŸ“ Trade Note Export** - Export detailed trading notes with complete opening and closing information
- **ğŸ“± Responsive Design** - Perfect adaptation for mobile, tablet, and desktop devices
- **ğŸŒ Internationalization** - Full Chinese/English UI with language switcher

## Features

### Core Features
- **Market Accounts Management**: Create and manage multiple market accounts (US stocks, HK stocks, crypto)
- **Role-Based Permissions**: Project-level access control (ADMIN/VIEWER)
- **Trade Records**: Detailed logging of every trade with analysis and notes
- **Position Tracking**: Real-time position monitoring with P&L calculation
- **Order Management**: Pending orders with status tracking (PENDING/FILLED/CANCELLED)
- **Cash Adjustments**: Track deposits, withdrawals, fees, and interest
- **Matched Trades**: Intelligent identification of opening/closing trade pairs
- **Trade Sharing**: Generate Futu-style trading share images with custom layouts
- **Trade Notes Export**: Export detailed trading notes with complete information
- **Position Sharing**: Generate position overview with QR code integration
- **Attachment Support**: Add images to trades and daily balances
- **Audit Logs**: Automatic logging of all key operations
- **ğŸŒ Internationalization**: Full Chinese/English UI with language switcher

### Permission Control
- Resource-level permissions based on ProjectMember
- Users without project access receive 403 errors
- VIEWER role: read-only access (GET/HEAD/OPTIONS)
- ADMIN role: full access (POST/PUT/PATCH/DELETE)
- Attachment access requires project verification

### Frontend Features
- Mobile-first responsive design
- Bottom tab navigation for mobile
- Large touch-friendly buttons
- Numeric keyboard support
- Card-based list display
- Markdown support (trade analysis)
- **Language switcher** in navigation bar
- **Real-time translation** for all UI elements

## Quick Start

### 1. Requirements
- Python 3.8+
- Node.js 16+ and npm
- pip

### 2. Initialize Project

```bash
# Navigate to project directory
cd ~/Html-Project/Stocks-Lab

# Initialize backend
./manage.sh setup
./manage.sh migrate
./manage.sh admin

# Install frontend dependencies
cd frontend && npm install && cd ..

# (Optional) Generate test data
source venv/bin/activate
python create_test_data.py
```

### 3. Start Development Environment

**Option 1: Unified Start (Recommended)**
```bash
./start_dev.sh
```

This uses tmux to start both frontend and backend services.

**Option 2: Separate Start**
```bash
# Terminal 1 - Start backend (port 20004)
./manage.sh run

# Terminal 2 - Start frontend (port 20003)
cd frontend && npm run dev
```

### 4. Access System

- **Frontend**: http://localhost:20003
- **Admin Panel**: http://localhost:20004/admin
- **API Endpoints**: http://localhost:20004/api/v1

Test accounts (after running `create_test_data.py`):
- Admin: `admin` / `admin123`
- Viewer: `viewer` / `viewer123`

### 5. Stop Services

```bash
./stop_dev.sh
```

**Detailed Port Configuration**: See [PORT_CONFIGURATION.md](PORT_CONFIGURATION.md)

## Internationalization (i18n)

### Switching Languages

1. Click the language switcher in the navigation bar (CN/EN buttons)
2. Language preference is saved in browser localStorage
3. All pages update automatically on language change

### Supported Pages
- âœ… Login page
- âœ… Account list
- âœ… Account details (including modals)
- âœ… Add security form
- âœ… Add trade form
- âœ… Cash adjustment modal
- âœ… Delete confirmation dialogs

### Translation System
- **File**: `/static/js/i18n.js`
- **200+ translation keys** covering all UI elements
- **Client-side translation** for instant language switching
- **Persistent language selection** across sessions

## Usage Workflow

### Create Projects and Add Members

1. Login to admin panel: http://localhost:8002/admin
2. Create new project in "Investment Projects"
3. Add members in "Project Members":
   - Select project
   - Select user
   - Set role (ADMIN or VIEWER)

### Add Contribution Records

1. Navigate to admin "Contribution Records"
2. Click "Add contribution record"
3. Fill in contribution details:
   - Select project
   - Select contributor
   - Enter amount
   - Set contribution date

### Using Frontend Interface

1. Login to frontend: http://localhost:8002
2. Select project from dashboard
3. Admins can:
   - Add daily balance records
   - Add trade records
   - View all data
4. Viewers can:
   - View daily balances
   - View trade records
   - View contribution records

## API Endpoints

**Base URL**: `http://localhost:20004/api/v1`

### Authentication
- `POST /login/` - Login (Django session)
- `POST /logout/` - Logout
- `GET /api/v1/me/` - Get current user info

### Market Accounts
- `GET /api/v1/accounts/` - List market accounts
- `POST /api/v1/accounts/` - Create account (auto-assigned as admin)
- `GET /api/v1/accounts/{id}/` - Get account details
- `GET /api/v1/accounts/{id}/trades/` - Get account trades
- `GET /api/v1/accounts/{id}/positions/` - Get account positions

### Securities
- `GET /api/v1/securities/` - List securities
- `POST /api/v1/securities/` - Create security (admin only)
- `GET /api/v1/securities/{id}/` - Get security details

### Trades
- `GET /api/v1/trades/` - List trades
  - Query params: `account`, `security`, `action`, `status`, `from_date`, `to_date`
- `POST /api/v1/trades/` - Create trade (admin only)
- `GET /api/v1/trades/{id}/` - Get trade details
- `PATCH /api/v1/trades/{id}/` - Update trade (admin only)
- `POST /api/v1/trades/{id}/confirm_fill/` - Confirm pending order
- `POST /api/v1/trades/{id}/cancel/` - Cancel pending order

### Positions
- `GET /api/v1/positions/` - List positions
- `GET /api/v1/positions/{id}/` - Get position details
- `POST /api/v1/positions/{id}/close/` - Close position

### Audit Logs
- `GET /api/v1/audit-logs/` - Get audit logs (own operations only)
  - Query params: `action`, `model_type`, `model_id`

## Management Commands

```bash
# Start frontend and backend together
./start_dev.sh

# Stop all services
./stop_dev.sh

# Check port status
./check_ports.sh

# View system status
./manage.sh status

# Run database migrations
./manage.sh migrate

# Create admin user
./manage.sh admin

# Start backend server (port 20004)
./manage.sh run

# Start frontend server (port 20003)
cd frontend && npm run dev

# Enter Django Shell
./manage.sh shell

# Collect static files
./manage.sh static

# Clean cache files
./manage.sh clean

# Backup database
./manage.sh backup
```

## Project Structure

```
Stocks-Lab/
â”œâ”€â”€ manage.py                 # Django management script
â”œâ”€â”€ manage.sh                 # Project management script
â”œâ”€â”€ requirements.txt          # Python dependencies
â”œâ”€â”€ .env.example             # Environment variables example
â”œâ”€â”€ .gitignore               # Git ignore file
â”œâ”€â”€ db.sqlite3               # SQLite database
â”œâ”€â”€ stocks_lab/              # Django project config
â”‚   â”œâ”€â”€ settings.py          # Project settings
â”‚   â”œâ”€â”€ urls.py              # Main URL configuration
â”‚   â””â”€â”€ ...
â”œâ”€â”€ core/                     # Core application
â”‚   â”œâ”€â”€ models.py            # Data models
â”‚   â”œâ”€â”€ serializers.py       # DRF serializers
â”‚   â”œâ”€â”€ viewsets.py          # DRF viewsets
â”‚   â”œâ”€â”€ views.py             # Frontend views
â”‚   â”œâ”€â”€ permissions.py       # Permission classes
â”‚   â””â”€â”€ ...
â”œâ”€â”€ templates/                # Frontend templates
â”‚   â”œâ”€â”€ base_new.html        # Base template
â”‚   â”œâ”€â”€ login_new.html       # Login page
â”‚   â”œâ”€â”€ accounts_list.html   # Account list
â”‚   â”œâ”€â”€ account_detail.html  # Account details
â”‚   â”œâ”€â”€ security_form.html   # Add security form
â”‚   â”œâ”€â”€ trade_form.html      # Add trade form
â”‚   â””â”€â”€ ...
â”œâ”€â”€ static/                   # Static files
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ i18n.js          # Internationalization translations
â””â”€â”€ media/                    # Media files (attachment storage)
```

## Technology Stack

### Backend
- Django 4.2.9
- Django REST Framework 3.14.0
- django-cors-headers 4.3.1
- django-filter 23.5
- Pillow 10.1.0 (image processing)
- Markdown 3.5.1 (markdown rendering)

### Frontend
- Django Templates
- Vanilla JavaScript (Fetch API)
- Responsive CSS (Mobile-first)
- **Client-side i18n** with localStorage persistence

### Database
- SQLite3 (development)
- Easy migration to PostgreSQL/MySQL

## Development Guide

### Adding New Features

1. Modify `core/models.py` to add new models
2. Run `./manage.sh migrate` to create database tables
3. Add serializers in `core/serializers.py`
4. Add viewsets in `core/viewsets.py`
5. Register routes in `core/urls.py`
6. Register admin interface in `core/admin.py`

### Adding Translations

Edit `/static/js/i18n.js`:

```javascript
const translations = {
    'zh-hans': {
        'your_key': 'ä¸­æ–‡æ–‡æœ¬',
        // ...
    },
    'en': {
        'your_key': 'English text',
        // ...
    }
};
```

In HTML template:
```html
<span id="your-element">ä¸­æ–‡æ–‡æœ¬</span>

<script>
document.getElementById('your-element').textContent = t('your_key');
</script>
```

### Custom Permissions

Inherit `BasePermission` class in `core/permissions.py`:

```python
from rest_framework.permissions import BasePermission

class CustomPermission(BasePermission):
    def has_permission(self, request, view):
        # Your logic here
        return True
```

## Production Deployment

1. **Change SECRET_KEY**: Generate new key and set in `.env`
2. **Disable DEBUG**: Set `DEBUG=False`
3. **Configure ALLOWED_HOSTS**: Add your domain
4. **Use PostgreSQL**: Replace SQLite database
5. **Configure S3**: Migrate attachments to S3
6. **Use Nginx + Gunicorn**: Production web server
7. **Enable HTTPS**: Configure SSL certificate
8. **Collect static files**: Run `./manage.sh static`

## FAQ

### Q: How to reset password?
A: Use admin panel or Django Shell:
```python
from django.contrib.auth.models import User
user = User.objects.get(username='username')
user.set_password('new_password')
user.save()
```

### Q: How to backup data?
A: Run `./manage.sh backup` to automatically backup SQLite database.

### Q: How to switch to PostgreSQL?
A: Modify `DATABASES` config in `stocks_lab/settings.py`.

### Q: Attachment upload failed?
A: Check `media/` directory permissions, ensure Django process has write access.

### Q: How to add more languages?
A: Edit `static/js/i18n.js` and add new language entries to the `translations` object.

## License

This project is for educational and personal use only.

## Contact

For questions or suggestions, please contact the project maintainer.

---

**Note**: This is a disclosure platform, not a trading system. It does not connect to broker APIs. All data is manually entered.
